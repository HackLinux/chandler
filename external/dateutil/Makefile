include ../Makefile.inc

VERSION=1.1
RELVER=$(VERSION)-$(BRANCH_REV_PREFIX)1
DATEUTIL=$(BUILD_ROOT)/dateutil
MANIFEST=$(SNAP)/$(SITE)/dateutil
BUILD=build_$(SNAP)
SRC=python-dateutil-$(VERSION)
TARBALL=dateutil-$(SNAP)-$(RELVER).tar.gz

$(SRC).tar.bz2:
	$(CURL) http://builds.osafoundation.org/external/$(SRC).tar.bz2

sources: python-dateutil-$(VERSION).tar.bz2

$(SRC)-expanded: $(SRC).tar.bz2
	tar xvjf $(SRC).tar.bz2
	touch $(SRC)-expanded

expand: $(SRC)-expanded

apply: patches-$(VERSION)
	patch -Nup0 < patches-$(VERSION); echo ok

build: expand #apply
	cd $(SRC); \
	MACOSX_DEPLOYMENT_TARGET=$(MACOSX_DEPLOYMENT_TARGET) $(PYTHON) setup.py \
          build --build-base=$(BUILD) $(DIST_OPT) \
          install --force

binaries: strip
	cd $(BUILD_ROOT); \
      find $(MANIFEST) -name "*.pyc" | xargs rm -f; \
      find $(MANIFEST) -name "*.pyo" | xargs rm -f; \
      tar -C $(BUILD_ROOT) -cvzf $(DATEUTIL)/$(TARBALL) $(MANIFEST)

install: $(TARBALL)
	cp -p $(TARBALL) $(CHANDLERARCHIVES)

ifneq (/,$(SRC)/$(BUILD))
clean:
	rm -rf $(SRC)/$(BUILD)
endif
