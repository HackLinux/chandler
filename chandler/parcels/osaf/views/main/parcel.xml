<?xml version="1.0" encoding="UTF-8"?>

<!-- $Revision$ -->
<!-- $Date$ -->
<!-- Copyright (c) 2003-2004 Open Source Applications Foundation -->
<!-- License: http://osafoundation.org/Chandler_0.1_license_terms.htm -->

<core:Parcel itsName="main"
             xmlns:core="parcel:core"
             xmlns="parcel:osaf.framework.blocks"
             xmlns:doc="parcel:osaf.views.main"
             xmlns:repository="parcel:osaf.views.repositoryviewer"
             xmlns:demo="parcel:osaf.views.demo"
             xmlns:contentModel="parcel:osaf.pim"
             xmlns:mail="parcel:osaf.pim.mail"
             xmlns:tasks="parcel:osaf.pim.tasks"
             xmlns:app="parcel:osaf.app"
             xmlns:calendar="parcel:osaf.framework.blocks.calendar"
             xmlns:calendarModel="parcel:osaf.pim.calendar"
             xmlns:contacts="parcel:osaf.pim.contacts"
             xmlns:detail="parcel:osaf.framework.blocks.detail"
             >

  <core:version>0.3</core:version>

  <!--
    Block Events
  -->

  <BlockEvent itsName="ChangeLayout">
    <blockName>ChangeLayout</blockName>
    <dispatchEnum>BroadcastInsideMyEventBoundary</dispatchEnum>
  </BlockEvent>
  
  <!-- This is BroadcastEverywhere because several different
       parts of the app need to redisplay in the event (sic) of
       the user changing timezone; e.g. the minical, preview,
       calendar and detail views. -->
  <BlockEvent itsName="TimeZoneChange">
    <blockName>TimeZoneChange</blockName>
    <dispatchEnum>BroadcastEverywhere</dispatchEnum>
  </BlockEvent>
  
  <ContextMenu itsName="sidebarContextMenu">
    <childrenBlocks itemref="doc:OpenTabContextItem"/>
    <childrenBlocks itemref="doc:CloseTabContextItem"/>
  </ContextMenu>
  
  <ContextMenuItem itsName="OpenTabContextItem">
    <title>Open in New Tab</title>
    <event itemref="Open"/>
  </ContextMenuItem>

  <ContextMenuItem itsName="CloseTabContextItem">
    <title>Close Tab</title>
    <event itemref="Close"/>
  </ContextMenuItem>

  <!--
    ApplicationBar
  -->




  <!--
    Odds and ends refered to by the user interface
  -->
  <Timer itsName="ReminderTimer"
         itemClass="osaf.framework.blocks.ControlBlocks.ReminderTimer">
    <blockName>ReminderTimer</blockName>
    <event itemref="doc:ReminderTime"/>
    <eventsForNamedLookup itemref="doc:ReminderTime"/>
    <contents itemref="doc:ReminderItems"/>
  </Timer> 
  
  <contentModel:FilteredCollection itsName="ReminderItems">
    <displayName>ReminderItems</displayName>
    <indexName value="reminderTime"/>
    <source itemref="doc:events"/>
    <filterExpression>item.hasLocalAttributeValue('reminderTime') == True</filterExpression>
    <filterAttributes>reminderTime</filterAttributes>
  </contentModel:FilteredCollection>

  <!--
    Collections
  -->
  <contentModel:ListCollection itsName="sidebarItemCollection">
    <refCollection itemref="doc:allCollection"/>
    <refCollection itemref="doc:inCollection"/>
    <refCollection itemref="doc:outCollection"/>
    <refCollection itemref="app:TrashCollection"/>
  </contentModel:ListCollection>

  <contentModel:KindCollection itsName="notes">
    <kind itemref="contentModel:Note"/>
    <recursive>True</recursive>
  </contentModel:KindCollection>

  <contentModel:KindCollection itsName="events">
    <kind itemref="calendarModel:CalendarEventMixin"/>
    <recursive>True</recursive>
  </contentModel:KindCollection>

  <contentModel:FilteredCollection itsName="generatedEvents">
    <source itemref="doc:events"/>
    <filterExpression>getattr(item, 'isGenerated', True)</filterExpression>
    <filterAttributes>isGenerated</filterAttributes>
  </contentModel:FilteredCollection>

  <contentModel:DifferenceCollection itsName="notesMinusGeneratedEvents">
    <sources itemref="doc:notes"/>
    <sources itemref="doc:generatedEvents"/>
  </contentModel:DifferenceCollection>

  <contentModel:DifferenceCollection itsName="allSource">
    <sources itemref="doc:notesMinusGeneratedEvents"/>
    <sources itemref="app:TrashCollection"/>
  </contentModel:DifferenceCollection>

  <contentModel:ListCollection itsName="allExclusions">
  </contentModel:ListCollection>

  <contentModel:DifferenceCollection itsName="allSourceMinusAllExclusions">
    <sources itemref="doc:allSource"/>
    <sources itemref="doc:allExclusions"/>
  </contentModel:DifferenceCollection>

  <contentModel:ListCollection itsName="allInclusions">
  </contentModel:ListCollection>

  <contentModel:InclusionExclusionCollection itsName="allCollection">
    <sources itemref="doc:allSourceMinusAllExclusions"/>
    <sources itemref="doc:allInclusions"/>
    <displayName>All</displayName>
    <renameable>False</renameable>
  </contentModel:InclusionExclusionCollection>


  <contentModel:KindCollection itsName="mail">
    <kind itemref="mail:MailMessageMixin"/>
    <recursive>True</recursive>
  </contentModel:KindCollection>

  <contentModel:FilteredCollection itsName="inSource">
    <source itemref="doc:mail"/>
    <filterExpression>item.isInbound == True</filterExpression>
    <filterAttributes>isInbound</filterAttributes>
  </contentModel:FilteredCollection>

  <contentModel:ListCollection itsName="inExclusions">
  </contentModel:ListCollection>

  <contentModel:DifferenceCollection itsName="inSourceMinusInExclusions">
    <sources itemref="doc:inSource"/>
    <sources itemref="doc:inExclusions"/>
  </contentModel:DifferenceCollection>

  <contentModel:ListCollection itsName="inInclusions">
  </contentModel:ListCollection>

  <contentModel:InclusionExclusionCollection itsName="inCollection">
    <sources itemref="doc:inSourceMinusInExclusions"/>
    <sources itemref="doc:inInclusions"/>
    <displayName>In</displayName>
    <renameable>False</renameable>
  </contentModel:InclusionExclusionCollection>


  <contentModel:FilteredCollection itsName="outSource">
    <source itemref="doc:mail"/>
    <filterExpression>item.isOutbound == True</filterExpression>
    <filterAttributes>isOutbound</filterAttributes>
  </contentModel:FilteredCollection>

  <contentModel:ListCollection itsName="outExclusions">
  </contentModel:ListCollection>

  <contentModel:DifferenceCollection itsName="outSourceMinusOutExclusions">
    <sources itemref="doc:outSource"/>
    <sources itemref="doc:outExclusions"/>
  </contentModel:DifferenceCollection>

  <contentModel:ListCollection itsName="outInclusions">
  </contentModel:ListCollection>

  <contentModel:InclusionExclusionCollection itsName="outCollection">
    <sources itemref="doc:outSourceMinusOutExclusions"/>
    <sources itemref="doc:outInclusions"/>
    <displayName>Out</displayName>
    <renameable>False</renameable>
  </contentModel:InclusionExclusionCollection>

  <!--
    Chandler's main view
  -->
  
  <doc:SidebarBlock itsName="Sidebar">
    <contents itemref="doc:sidebarItemCollection"/>
    <selectedItemToView itemref="doc:allCollection"/>
  </doc:SidebarBlock>

  <calendar:PreviewArea itsName="PreviewArea">
    <blockName>PreviewArea</blockName>
    <contents itemref="doc:allCollection"/>
  </calendar:PreviewArea>

  <calendar:MiniCalendar itsName="MiniCalendar">
    <blockName>MiniCalendar</blockName>
    <contents itemref="doc:allCollection"/>    
  </calendar:MiniCalendar>

  <TrunkParentBlock itsName="SidebarTPB">
    <blockName value="SidebarTPB"/>
    <TPBDetailItem itemref="doc:allCollection"/>
    <TPBSelectedItem itemref="doc:allCollection"/>
  </TrunkParentBlock>


  <SplitterWindow itsName="TableSummaryViewTemplate">
    <blockName>TableSummaryViewTemplate</blockName>
    <childrenBlocks itemref="doc:TableSummaryView"/>
    <childrenBlocks itemref="doc:TableSummaryDetailTPB"/>
    <eventBoundary>True</eventBoundary>
    <orientationEnum>Vertical</orientationEnum>
    <splitPercentage>0.65</splitPercentage>
  </SplitterWindow>

  <Table itsName="TableSummaryView">
    <contents itemref="doc:allCollection"/>
    <blockName>TableSummaryView</blockName>
    <characterStyle itemref="SummaryRowStyle"/>
    <headerCharacterStyle itemref="SummaryHeaderStyle"/>
    <hasGridLines>True</hasGridLines>

    <columnHeadings></columnHeadings>
    <columnHeadings>who</columnHeadings>
    <columnHeadings>about</columnHeadings>
    <columnHeadings>date</columnHeadings>

    <columnData>itsKind</columnData>
    <columnData>who</columnData>
    <columnData>about</columnData>
    <columnData>date</columnData>
    
    <columnWidths>20</columnWidths>
    <columnWidths>130</columnWidths>
    <columnWidths>130</columnWidths>
    <columnWidths>130</columnWidths>

    <columnReadOnly>True</columnReadOnly>
    <columnReadOnly>True</columnReadOnly>
    <columnReadOnly>False</columnReadOnly>
    <columnReadOnly>True</columnReadOnly>

    <selection>
      <core:Integer value="0"/>
      <core:Integer value="0"/>
    </selection>
  </Table>

  <TrunkParentBlock itsName="TableSummaryDetailTPB">
    <blockName>TableSummaryDetailTPB</blockName>
    <trunkDelegate itemref="doc:TableSummaryDetailTrunkDelegate"/>
  </TrunkParentBlock>

  <detail:DetailTrunkDelegate itsName="TableSummaryDetailTrunkDelegate">
    <trunkStub itemref="detail:DetailRoot"/>
  </detail:DetailTrunkDelegate>


  <SplitterWindow itsName="CalendarSummaryViewTemplate">
    <blockName>CalendarSummaryViewTemplate</blockName>

    <childrenBlocks itemref="doc:CalendarSummaryView"/>

    <childrenBlocks itemref="doc:CalendarDetailTPB"/>
    <eventBoundary>True</eventBoundary>
    <orientationEnum>Vertical</orientationEnum>
    <splitPercentage>0.65</splitPercentage>
  </SplitterWindow>


<!-- main calendar area -->

  <calendar:CalendarContainer itsName="CalendarSummaryView">
    <blockName>CalendarSummaryView</blockName>
    <childrenBlocks itemref="doc:MainCalendarControl"/>
    <calendarControl itemref="doc:MainCalendarControl"/>
    <!-- <childrenBlocks itemref="doc:WeekColumnHeader"/> -->
    <childrenBlocks itemref="doc:MainCalendarCanvasSplitter"/>
    <orientationEnum>Vertical</orientationEnum>
    <eventsForNamedLookup itemref="doc:TimeZoneChange"/>
  </calendar:CalendarContainer>


    <calendar:CalendarControl itsName="MainCalendarControl">
      <blockName value="MainCalendarControl"/>
      <calendarContainer itemref="doc:CalendarSummaryView"/>
      <stretchFactor value="0"/>
      <!-- set contents to an empty collection somehow... -->
    </calendar:CalendarControl>
  
    <!--<StaticText itsName="WeekColumnHeader">-->
      <!--<blockName value="arel's newfangled week ColumnHeader"/>-->
      <!--<title value="arel's newfangled week ColumnHeader goes here"/>-->
      <!--<stretchFactor value="0"/>-->
    <!--</StaticText>-->
  
  
    <calendar:CanvasSplitterWindow itsName="MainCalendarCanvasSplitter">
      <blockName value="MainCalendarCanvasSplitter"/>
      
      <childrenBlocks itemref="doc:AllDayEvents"/>
      <childrenBlocks itemref="doc:TimedEvents"/>
      
      <!-- as small as possible; AllDayEvents's SetMinSize() should override? -->
      <splitPercentage value="0.01"/>
      <orientationEnum>Horizontal</orientationEnum>      
      <stretchFactor value="1"/>
    </calendar:CanvasSplitterWindow>
  
      <calendar:AllDayEventsCanvas itsName="AllDayEvents">
        <blockName value="AllDayEventsCanvas"/>
        <calendarContainer itemref="doc:CalendarSummaryView"/>
        <stretchFactor value="0"/> <!-- splitterwindows, unlike boxcontainers, ignore this -->
        <contents itemref="doc:allCollection"/>
      </calendar:AllDayEventsCanvas>
  
      <calendar:TimedEventsCanvas itsName="TimedEvents">
        <blockName value="TimedEventsCanvas"/>
        <calendarContainer itemref="doc:CalendarSummaryView"/>
        <stretchFactor value="0"/> <!-- ignored -->
        <contents itemref="doc:allCollection"/>
      </calendar:TimedEventsCanvas>
<!-- end main calendar area -->

  <TrunkParentBlock itsName="CalendarDetailTPB">
    <blockName>CalendarDetailTPB</blockName>
    <trunkDelegate itemref="doc:CalendarDetailTrunkDelegate"/>
  </TrunkParentBlock>

  <detail:DetailTrunkDelegate itsName="CalendarDetailTrunkDelegate">
    <trunkStub itemref="detail:DetailRoot"/>
  </detail:DetailTrunkDelegate>

  <!--
    CPIA test view: like a unit test/testing ground for CPIA
  -->
  <View itsName="CPIATestMainView"
        itemClass="osaf.views.main.Main.MainView">

    <displayName>CPIATestMainView</displayName>
    <blockName>MainView</blockName>

    <childrenBlocks itemref="doc:MenuBar" copy="CPIATestMenuBar"/>
    <childrenBlocks itemref="doc:StatusBar" copy="CPIATestStatusBar"/>
    <childrenBlocks itemref="doc:ReminderTimer" copy="CPIATestReminderTimer"/>
    <childrenBlocks itemref="doc:CPIATestMainContainer"/>

    <eventsForNamedLookup itemref="doc:RequestSelectSidebarItem"/>
    <eventsForNamedLookup itemref="doc:SendMail"/>
    <eventsForNamedLookup itemref="doc:ShareItem"/>
    <eventsForNamedLookup itemref="doc:AddToSidebarWithoutCopying"/>
    <eventsForNamedLookup itemref="doc:AddToSidebarWithoutCopyingOrCommiting"/>
    <eventsForNamedLookup itemref="doc:AddToSidebarWithoutCopyingAndSelectFirst"/>

    <orientationEnum>Vertical</orientationEnum>
    <size>900,600</size>
    <eventBoundary>True</eventBoundary>
    <viewContainer itemref="doc:MainViewRoot"/>
  </View>

  <BoxContainer itsName="CPIATestMainContainer">
    <childrenBlocks itemref="doc:ApplicationBar" copy="CPIATestApplicationBar"/>
    <childrenBlocks itemref="doc:CPIATestMainSplitter"/>
    <orientationEnum>Vertical</orientationEnum>
  </BoxContainer>

  <SplitterWindow itsName="CPIATestMainSplitter">
    <childrenBlocks itemref="doc:CPIATestSidebarContainer"/>
    <childrenBlocks itemref="doc:CPIATestTabbedView"/>
    <orientationEnum>Vertical</orientationEnum>
    <splitPercentage>0.2</splitPercentage>
  </SplitterWindow>
  
  <SplitterWindow itsName="CPIATestSidebarContainer">
    <blockName>SidebarContainer</blockName>
    <childrenBlocks itemref="doc:Sidebar" copy="CPIATestSidebar"/>
    <childrenBlocks itemref="doc:MiniCalendar" copy="CPIATestMiniCalendar"/>
    <orientationEnum>Horizontal</orientationEnum>
    <stretchFactor>0.0</stretchFactor>
  </SplitterWindow>

  <TabbedContainer itsName="CPIATestTabbedView"
                   itemClass="osaf.framework.blocks.ContainerBlocks.TabbedView">
    <childrenBlocks itemref="doc:CPIATestSidebarDetailView"/>
  </TabbedContainer>  

  <TrunkParentBlock itsName="CPIATestSidebarDetailView">
    <blockName>CPIATestSidebarDetailView</blockName>
    <TPBDetailItem itemref="doc:allCollection"/>
    <TPBSelectedItem itemref="doc:allCollection"/>
    <trunkDelegate itemref="doc:CPIATestSidebarTrunkDelegateInstance"/>
  </TrunkParentBlock>

  <doc:CPIATestSidebarTrunkDelegate itsName="CPIATestSidebarTrunkDelegateInstance">
    <templatePath>//parcels/osaf/views/main/CPIATestTableSummaryViewTemplate</templatePath>
  </doc:CPIATestSidebarTrunkDelegate>

  <SplitterWindow itsName="CPIATestTableSummaryViewTemplate">
    <blockName>SidebarDetailView</blockName>
    <childrenBlocks itemref="doc:CPIATestSummaryView"/>
    <childrenBlocks itemref="doc:CPIATestSummaryDetailTPB"/>
    <eventBoundary>True</eventBoundary>
  </SplitterWindow>

  <LayoutChooser itsName="CPIATestSummaryView">
    <blockName>CPIATestSummaryView</blockName>
    <childrenBlocks itemref="doc:CPIATestLayoutToolbar"/>
    <childrenBlocks itemref="doc:CPIATestTable"/>
    <choices itemref="doc:CPIATestTable"/>
    <choices itemref="doc:CPIATestWeek"/>
    <choices itemref="doc:CPIATestDay"/>    
    <orientationEnum>Vertical</orientationEnum>
  </LayoutChooser>

  <!--
    Layout Toolbar
  -->
  <Toolbar itsName="CPIATestLayoutToolbar">
    <childrenBlocks itemref="doc:ListViewButton"/>
    <childrenBlocks itemref="doc:WeekViewButton"/>
    <childrenBlocks itemref="doc:DayViewButton"/>
    <toolSize>16,16</toolSize>
    <separatorWidth>100</separatorWidth>
    <stretchFactor>0.0</stretchFactor>
    <eventsForNamedLookup itemref="doc:ChangeLayout"/>
  </Toolbar>

  <ToolbarItem itsName="ListViewButton">
    <blockName>ListViewButton1</blockName>
    <title>List View</title>
    <bitmap>list.png</bitmap>
    <toolbarItemKind>Radio</toolbarItemKind>
    <helpString>Display the view in list mode</helpString>
    <event itemref="doc:ChangeLayout"/>
  </ToolbarItem>

  <ToolbarItem itsName="WeekViewButton">
    <blockName>WeekViewButton1</blockName>
    <title>Week View</title>
    <bitmap>week.png</bitmap>
    <toolbarItemKind>Radio</toolbarItemKind>
    <helpString>Display the view in week mode</helpString>
    <event itemref="doc:ChangeLayout"/>
  </ToolbarItem>

  <ToolbarItem itsName="DayViewButton">
    <blockName>DayViewButton1</blockName>
    <title>Day View</title>
    <bitmap>day.png</bitmap>
    <toolbarItemKind>Radio</toolbarItemKind>
    <helpString>Display the view in day mode</helpString>
    <event itemref="doc:ChangeLayout"/>
  </ToolbarItem>

  <Table itsName="CPIATestTable">
    <contents itemref="core:None"/>

    <columnHeadings></columnHeadings>
    <columnHeadings>who</columnHeadings>
    <columnHeadings>about</columnHeadings>
    <columnHeadings>date</columnHeadings>

    <columnData>itsKind</columnData>
    <columnData>who</columnData>
    <columnData>about</columnData>
    <columnData>date</columnData>
    
    <columnWidths>20</columnWidths>
    <columnWidths>130</columnWidths>
    <columnWidths>130</columnWidths>
    <columnWidths>130</columnWidths>

    <columnReadOnly>True</columnReadOnly>
    <columnReadOnly>True</columnReadOnly>
    <columnReadOnly>False</columnReadOnly>
    <columnReadOnly>True</columnReadOnly>
  </Table>

  <calendar:CalendarContainer itsName="CPIATestWeek">
    <contents itemref="core:None"/>
    
  </calendar:CalendarContainer>

  <calendar:CalendarContainer itsName="CPIATestDay">
    <contents itemref="core:None"/>
  </calendar:CalendarContainer>

  <TrunkParentBlock itsName="CPIATestSummaryDetailTPB">
    <blockName>CPIATestSummaryDetailTPB</blockName>
    <trunkDelegate itemref="doc:CPIATestSummaryTrunkDelegate"/>
  </TrunkParentBlock>

  <detail:DetailTrunkDelegate itsName="CPIATestSummaryTrunkDelegate">
    <trunkStub itemref="detail:DetailRoot"/>
  </detail:DetailTrunkDelegate>


</core:Parcel>
